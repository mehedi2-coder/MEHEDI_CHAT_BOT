const schedule = require('node-schedule');
const chalk = require('chalk');
const moment = require('moment-timezone');

module.exports.config = {
    name: 'autosent',
    version: '1.2.1',
    hasPermssion: 0,
    credits: 'ð— ð—²ð—µð—²ð—±ð—¶ ð—›ð—®ð˜€ð—®ð—»', // Don't Remove Credits
    description: 'Automatically sends styled hourly messages in all groups (BD Time, 12h format)',
    commandCategory: 'group messenger',
    usages: '[]',
    cooldowns: 3
};

const captions = {
    0: "ðŸŒŒ à¦†à¦°à§‹ à¦à¦•à¦Ÿà¦¿ à¦¦à¦¿à¦¨ à¦¶à§‡à¦·à¥¤\nðŸ˜´ à¦¨à¦¤à§à¦¨ à¦¦à¦¿à¦¨à§‡à¦° à¦¶à§à¦°à§, à¦¶à§à¦­à¦°à¦¾à¦¤à§à¦°à¦¿ à¦¸à¦¬à¦¾à¦‡à¦•à§‡! ðŸ’¤ðŸ’Œ",
    1: "ðŸƒ à¦…à¦¨à§‡à¦• à¦¦à§‡à¦°à¦¿ à¦¹à§Ÿà§‡ à¦—à§‡à¦›à§‡, à¦˜à§à¦®à¦¿à§Ÿà§‡ à¦ªà§œà§‹ à¦¤à¦¾à§œà¦¾à¦¤à¦¾à§œà¦¿! ðŸ˜´",
    2: "ðŸ˜’ à¦¯à¦¾à¦°à¦¾ à¦œà§‡à¦—à§‡ à¦†à¦›à§‹ à¦¤à§‹à¦®à¦¾à¦¦à§‡à¦° à¦à¦•à¦Ÿà§ à¦˜à§à¦®à¦¾à¦¨à§‹ à¦¦à¦°à¦•à¦¾à¦°! ðŸ¥±",
    3: "ðŸŒŒ à¦…à¦¨à§‡à¦• à¦°à¦¾à¦¤ à¦¹à¦²à§‹, à¦¸à¦•à¦¾à¦²à§‡à¦° à¦†à¦—à§‡ à¦¬à¦¿à¦¶à§à¦°à¦¾à¦® à¦¨à¦¾à¦“! ðŸ›Œ",
    4: "ðŸ¥± à¦‰à¦ à§‹, à¦«à¦œà¦°à§‡à¦° à¦¸à¦®à§Ÿ à¦•à¦¾à¦›à¦¾à¦•à¦¾à¦›à¦¿! ðŸ™†â€â™‚ï¸",
    5: "ðŸ•Œ à¦†à¦œà¦¾à¦¨ à¦¹à§Ÿà§‡ à¦¯à¦¾à¦¬à§‡, à¦¸à¦¬à¦¾à¦‡ à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦ªà§à¦°à¦¸à§à¦¤à§à¦¤à¦¿ à¦¨à¦¾à¦“! ðŸ’â€â™‚ï¸",
    6: "â˜€ï¸ à¦¶à§à¦­ à¦¸à¦•à¦¾à¦²! à¦¦à¦¿à¦¨ à¦¶à§à¦°à§ à¦¹à§‹à¦• à¦¬à¦°à¦•à¦¤à¦®à§Ÿà§· ðŸ¤²ðŸŒ¤",
    7: "âš¡ à¦ªà§œà¦¾à¦¶à§‹à¦¨à¦¾/à¦•à¦¾à¦œ à¦¶à§à¦°à§ à¦•à¦°à¦¾à¦° à¦¸à§‡à¦°à¦¾ à¦¸à¦®à§Ÿ! ðŸ“",
    8: "ðŸ’¼ à¦•à¦¾à¦œà§‡ à¦®à¦¨à§‹à¦¯à§‹à¦— à¦¦à§‡à¦“à§Ÿà¦¾à¦° à¦¸à§‡à¦°à¦¾ à¦¸à¦®à§Ÿ! ðŸ“¤",
    9: "â˜• à¦à¦• à¦•à¦¾à¦ª à¦šà¦¾/à¦•à¦«à¦¿ à¦¹à¦²à§‡ à¦­à¦¾à¦²à§‹ à¦¹à§Ÿ? ðŸ˜€âš¡",
    10: "ðŸ’ª à¦¸à¦¬à¦¾à¦‡ à¦‰à¦¦à§à¦¯à¦®à§€ à¦¥à¦¾à¦•à§‹! âš¡ðŸŽ¯",
    11: "âœ¨ à¦¨à¦¿à¦œà§‡à¦° à¦œà¦¨à§à¦¯ à¦¸à¦®à§Ÿ à¦¬à§‡à¦° à¦•à¦°à§‹! ðŸ• ",
    12: "ðŸŒ¤ï¸ à¦¶à§à¦­ à¦¦à§à¦ªà§à¦°, à¦—à§‹à¦¸à¦²à§‡à¦° à¦ªà§à¦°à¦¸à§à¦¤à§à¦¤à¦¿ à¦¨à¦¾à¦“ ðŸ›€!",
    13: "ðŸ•Œ à¦—à§‹à¦¸à¦² à¦•à¦°à§‡ à¦¯à§‹à¦¹à¦°à§‡à¦° à¦¸à¦¾à¦²à¦¾à¦¤ à¦†à¦¦à¦¾à§Ÿ à¦•à¦°à§‡ à¦¨à¦¾à¦“ ðŸ›€ðŸš¿à¥¤",
    14: "ðŸ¥˜ à¦–à¦¾à¦¬à¦¾à¦° à¦–à§‡à§Ÿà§‡ à¦à¦•à¦Ÿà§ à¦¬à¦¿à¦¶à§à¦°à¦¾à¦® à¦¨à¦¿à¦¤à§‡ à¦ªà¦¾à¦°à§‡à¦¾! ðŸ›‹",
    15: "ðŸ¥± à¦à¦•à¦Ÿà§ à¦ªà¦¾à¦“à§Ÿà¦¾à¦° à¦¨à§à¦¯à¦¾à¦ª à¦¨à¦¿à§Ÿà§‡ à¦¨à¦¿à¦²à§‡ à¦•à§‡à¦®à¦¨ à¦¹à§Ÿ? ðŸ˜€",
    16: "ðŸ•Œ à¦†à¦¸à¦°à§‡à¦° à¦¸à¦¾à¦²à¦¾à¦¤ à¦†à¦¦à¦¾à§Ÿ à¦•à¦°à§‡ à¦¨à¦¾à¦“! ðŸ§­",
    17: "ðŸš¶ à¦à¦•à¦Ÿà§ à¦¹à§‡à¦à¦Ÿà§‡ à¦¶à¦°à§€à¦° à¦¹à¦¾à¦²à¦•à¦¾ à¦•à¦°à§‡ à¦¨à¦¾à¦“! â›¹ï¸â€â™‚ï¸ðŸ¤¸â€â™€ï¸",
    18: "ðŸ•Œ à¦®à¦¾à¦—à¦°à¦¿à¦¬à§‡à¦° à¦¸à¦¾à¦²à¦¾à¦¤ à¦†à¦¦à¦¾à§Ÿ à¦•à¦°à§‡ à¦¨à¦¾à¦“! ðŸ•‹",
    19: "ðŸ‘¨â€ðŸ‘¦â€ðŸ‘¦ à¦«à§‹à¦¨ à¦¨à¦¾ à¦Ÿà¦¿à¦ªà§‡, à¦à¦–à¦¨ à¦à¦•à¦Ÿà§ à¦ªà¦°à¦¿à¦¬à¦¾à¦°à§‡à¦° à¦¸à¦¾à¦¥à§‡ à¦¸à¦®à§Ÿ à¦•à¦¾à¦Ÿà¦¾à¦“! ðŸ‘€ðŸ’™",
    20: "ðŸ“š à¦ªà§œà¦¾à¦¶à§‹à¦¨à¦¾ à¦¬à¦¾ à¦•à¦¾à¦œ à¦—à§à¦›à¦¿à§Ÿà§‡ à¦¨à¦¾à¦“ à¦à¦¬à¦‚ à¦¨à¦¿à¦œà§‡à¦° à¦²à¦•à§à¦·à§à¦¯ à¦¸à§‡à¦Ÿ à¦•à¦°à§‹ ðŸŽ¯!",
    21: "ðŸ•Œ à¦“à¦¯à§ à¦•à¦°à§‡ à¦ªà¦¾à¦•-à¦ªà¦¬à¦¿à¦¤à§à¦° à¦¹à§Ÿà§‡ à¦‡à¦¶à¦¾à¦°à§‡à¦° à¦¸à¦¾à¦²à¦¾à¦¤ à¦†à¦¦à¦¾à§Ÿ à¦•à¦°à§‡ à¦¨à¦¾à¦“! ðŸ§­",
    22: "ðŸ² à¦«à§‹à¦¨ à¦°à§‡à¦–à§‡, à¦°à¦¾à¦¤à§‡à¦° à¦–à¦¾à¦¬à¦¾à¦° à¦–à§‡à§Ÿà§‡ à¦¨à¦¾à¦“! ðŸ§†",
    23: "ðŸ˜´ à¦˜à§à¦®à¦¿à§Ÿà§‡ à¦ªà§œà¦¾à¦° à¦­à¦¾à¦²à§‹ à¦¸à¦®à§Ÿ, à¦¤à¦¾à§œà¦¾à¦¤à¦¾à§œà¦¿ à¦˜à§à¦®à¦¾à¦“ à¦¤à¦¾à§œà¦¾à¦¤à¦¾à§œà¦¿ à¦‰à¦ à§‹ ðŸ¥±!"
};

module.exports.onLoad = ({ api }) => {
    console.log(chalk.bold.hex("#00c300")("============ AUTOSENT COMMAND LOADED (BD TIME, 12h FORMAT) ============"));

    for (let h = 0; h < 24; h++) {
        const rule = new schedule.RecurrenceRule();
        rule.tz = 'Asia/Dhaka';
        rule.hour = h;
        rule.minute = 0;

        schedule.scheduleJob(rule, () => {
            if (!global.data?.allThreadID) return;

            const nowMoment = moment().tz('Asia/Dhaka');
            const formattedTime = nowMoment.format('hh:mm A'); 

            const message = captions[h] || "â° à¦¸à¦®à§Ÿà¦•à§‡ à¦•à¦¾à¦œà§‡ à¦²à¦¾à¦—à¦¾à¦“, à¦ªà§à¦°à¦¤à¦¿à¦Ÿà¦¾ à¦®à§à¦¹à§‚à¦°à§à¦¤à¦‡ à¦®à§‚à¦²à§à¦¯à¦¬à¦¾à¦¨!";

            const finalMessage =
`â•­â€¢â”„â”…â•â•â•âðŸŒ¼ââ•â•â•â”…â”„â€¢â•®

ðŸ•’ à¦à¦–à¦¨ à¦¸à¦®à§Ÿ: ${formattedTime} 
${message}

ðŸ”° à¦¸à¦®à§Ÿà¦•à§‡ à¦•à¦¾à¦œà§‡ à¦²à¦¾à¦—à¦¾à¦“,
ðŸ”¯ à¦ªà§à¦°à¦¤à¦¿à¦Ÿà¦¾ à¦®à§à¦¹à§‚à¦°à§à¦¤à¦‡ à¦®à§‚à¦²à§à¦¯à¦¬à¦¾à¦¨!

â•°â€¢â”„â”…â•â•â•ââ°ââ•â•â•â”…â”„â€¢â•¯`;

            global.data.allThreadID.forEach(threadID => {
                api.sendMessage(finalMessage, threadID, (error) => {
                    if (error) console.error(`Failed to send message to ${threadID}:`, error);
                });
            });

            console.log(chalk.hex("#00FFFF")(`Scheduled (BDT): ${formattedTime} => ${message}`));
        });
    }
};

module.exports.run = () => {
    // Main logic is in onLoad
};
